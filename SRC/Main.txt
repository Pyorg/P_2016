import pygame
from pygame.locals import *
import random

from Player import Player
# from Enemigo import Alien
from Rocas import Recs
from Proyectiles import Proyectil

lista = []

def colision(player, recs):
    for rec in recs.lista:
        if player.rect.colliderect(rec):
            return True
    return False

def colision2(proyectil, recs):
    for rec in recs.lista:
        if disparo.rect.colliderect(rec):
            return True
    return False

def main():
    import pygame

    pygame.init()
    pantalla=pygame.display.set_mode((900,600))
    salir=False
    reloj1= pygame.time.Clock()
    imagen1=pygame.image.load("Imagenes/nave.png").convert_alpha()
    imagenexplosion=pygame.image.load("Imagenes/explosion.png").convert_alpha()
    imagenfondo=pygame.image.load("Imagenes/fondo.png").convert_alpha()
    pygame.mixer.music.load("Imagenes/Heavy.mp3")
    sonido1=pygame.mixer.Sound("Imagenes/Plane_Fly.mp3")

    recs1=Recs(25)  # Llama a clase Recs

    #variables aux

    player1=Player(imagen1)

    vx,vy=0,0
    velocidad=10
    leftsigueapretada,rightsigueapretada,upsigueapretada,downsigueapretada=False,False,False,False
    colisiono=False

    pygame.mixer.music.play(2)

    while salir!=True:  # loop para eventos
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                salir=True
            if colisiono==False:
                if event.type == pygame.KEYDOWN:

                    if event.key == K_s:  # dispara con tecla s
                        x, y = player1.rect.center
                        player1.disparar(x,y)

                    if event.key == pygame.K_LEFT:
                        leftsigueapretada=True
                        vx=-velocidad
                    if event.key == pygame.K_RIGHT:
                        rightsigueapretada=True
                        vx=velocidad
                    if event.key== pygame.K_UP:
                        upsigueapretada=True
                        vy=-velocidad
                        sonido1.play()
                    if event.key == pygame.K_DOWN:
                        downsigueapretada=True
                        vy=velocidad

                if event.type == pygame.KEYUP:
                    if event.key == pygame.K_LEFT:
                        leftsigueapretada=False
                        if rightsigueapretada:vx=velocidad
                        else:vx=0
                    if event.key == pygame.K_RIGHT:
                        rightsigueapretada=False
                        if leftsigueapretada:vx=-velocidad
                        else:vx=0
                    if event.key== pygame.K_UP:
                        upsigueapretada=False
                        if downsigueapretada:vy=velocidad
                        else:vy=-0
                    if event.key == pygame.K_DOWN:
                        downsigueapretada=False
                        if upsigueapretada:vy=-velocidad
                        else:vy=0

        reloj1.tick(20)

        if colision(player1,recs1):
            colisiono=True
            player1.imagen=imagenexplosion
            pygame.mixer.music.stop()
        if colisiono==False:
            recs1.mover()
            player1.mover(vx, vy)

        pantalla.blit(imagenfondo,(0,0))
        recs1.pintar(pantalla)
        player1.update(pantalla)

        player1.dibujar(pantalla)

        if len(player1.listaDisparos) > 0:
            for x in player1.listaDisparos:
                x.dibujar(pantalla)  # se coloca el proyectil sobre la pantalla del juego
                x.trayectoria()  # trayectoria del proyectil
                if x.rect.top < 20:
                    player1.listaDisparos.remove(x)   # elimino el proyectil antes que salga del display
                else:
                    for recs1 in lista:
                        if x.rect.colliderect(recs1.rect):
                            lista.remove(recs1)
                            player1.listaDisparos.remove(x)
                            #pygame.mixer.music.load("Imagenes/Big_Explosion_Cut_Off.mp3")

        pygame.display.update()
        recs1.reagrear()
    pygame.quit()

main()
